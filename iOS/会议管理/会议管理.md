本文介绍如何通过网易会议组件管理会议的相关示例。

## 前提条件

根据本文操作前，请确保您已经完成了 [登录鉴权](https://doc.yunxin.163.com/meeting/guide/TM3Nzc1NDA?platform=iOS)。

## 离开或结束会议

您可以调用 [`leaveCurrentMeetingWithType`](https://doc.yunxin.163.com/docs/interface/meetingkit/iOS/doxygen/Latest/zh/interface_n_e_meeting_service.html#a642b9cfbb0fc430d79c50025ccb44b77) 离开当前进行中的会议，并通过参数控制（`leaveMeetingType`）是否同时结束当前会议。

```Objective-C

/**
* leaveMeetingType
* 0 所有设备离开会议；  
* 1 仅当前设备离开会议（当非多端入会场景时，调用仅当前设备离开会议等同于离开会议）
* 2 结束会议（仅当前账号是会议主持人/联席主持人时，该参数才有效。当非管理员时，调用结束会议等同于所有设备离开会议）
*/

  // 离开当前会议
  [[NEMeetingKit.getInstance getMeetingService]
      leaveCurrentMeetingWithType:leaveMeetingType
                         callback:^(NSInteger resultCode, NSString *resultMsg, id resultData) {
                           if (resultCode != ERROR_CODE_SUCCESS) {
                             [weakSelf showErrorCode:resultCode msg:resultMsg];
                           } else {
                             NSLog(@"离开会议成功: %@", typeName);
                           }
                         }];
```

## <span id="使用会议设置服务">查询用户的会议设置</span>

通过会议设置服务，设置和查询用户的当前会议设置，例如入会时的音视频开关状态、会议持续时间的显示等。

::: note note
- 每个已登录的用户有自己独立的一份会议设置项。其他所有未登录用户、匿名用户共享一份会议设置项。
- 会议设置项仅在当前设备上保存，不会漫游。
- 调用创建会议或加入会议方法时，若您设置 `NEMeetingOptions` 参数为 null，SDK 会使用会议设置服务中已保存的相关配置进行创会/入会。
:::

1. 调用 [`getSettingsService`](https://doc.yunxin.163.com/docs/interface/meetingkit/iOS/doxygen/Latest/zh/interface_n_e_meeting_kit.html#a84ee0fd78dd5647155980dc788720dca) 方法获取会议设置服务。

    **示例代码** 如下：

    ```Objective-C
    NESettingsService *settingsService = [[NEMeetingKit getInstance] getSettingsService];
    ```

2. 调用不同方法设置或查询会议设置项。

    - 设置或查询通用入会设置项

        **示例代码** 如下：

        ```Objective-C
        // 设置并保存会议设置
        [settingsService enableTurnOnMyAudioWhenJoinMeeting:YES];
        [settingsService enableTurnOnMyVideoWhenJoinMeeting:YES];

        //查询会议设置
        BOOL audioEnabled = [settingsService isTurnOnMyAudioWhenJoinMeetingEnabled];
        BOOL videoEnabled = [settingsService isTurnOnMyVideoWhenJoinMeetingEnabled];
        ```

    - 查询直播开通状态

        **示例代码** 如下：

        ```Objective-C
        /**
        * 查询直播开通状态
        */
        BOOL videoEnabled = [settingsService isMeetingLiveSupported];
        ```


## <span id="获取当前会议信息">获取当前会议信息</span>

在已经完成 SDK 登录鉴权的状态下，获取当前会议信息。

调用 [`getCurrentMeetingInfo`](https://doc.yunxin.163.com/docs/interface/meetingkit/iOS/doxygen/Latest/zh/interface_n_e_meeting_service.html#a06389417ee9e33cf061c6175422f30bf) 方法获取当前会议信息并进行回调处理。该接口的回调结果的数据类型为 [`NEMeetingInfo`](https://doc.yunxin.163.com/docs/interface/meetingkit/iOS/doxygen/Latest/zh/interface_n_e_meeting_info.html) 对象类型。

::: note note
请确认已经通过一种入会方式（加入会议/创建会议/匿名入会）加入到会议内，否则回调数据对象为空。
:::

**示例代码** 如下：

```Objective-C
[[NEMeetingKit getInstance].getMeetingService
      getCurrentMeetingInfo:^(NSInteger resultCode, NSString *_Nonnull resultMsg,
                              NEMeetingInfo *_Nonnull info){
          // code
      }];
```

## <span id="监听会议状态">监听会议状态</span>

通过注册会议状态回调接口，获取会议状态变更的通知。

1. 注册回调接口 [`addMeetingStatusListener`](https://doc.yunxin.163.com/docs/interface/meetingkit/iOS/doxygen/Latest/zh/interface_n_e_meeting_service.html#aa7a3294801071528c2c3a90597b43bd0) 开始监听，并在回调方法中根据您的需求处理相应事件。

    ::: note note
    该接口在初始化 SDK 成功后即可调用。
    :::

    **示例代码** 如下：

    ```Objective-C
    @interface AppVC () <NEMeetingStatusListener>
    @end

    @implementation AppVC

    - (void)viewDidLoad {
            [super viewDidLoad];
            [[NEMeetingKit getInstance].getMeetingService addMeetingStatusListener:self];
        }

    - (void)onMeetingStatusChanged:(nonnull NEMeetingEvent *)event {
        
    }
    @end
    ```

2. 反注册回调接口 [`removeMeetingStatusListener`](https://doc.yunxin.163.com/docs/interface/meetingkit/iOS/doxygen/Latest/zh/interface_n_e_meeting_service.html#acbda877b4a343732a73a0f3d2c1e3d03) 停止监听。

    **示例代码** 如下：

    ```Objective-C
    @interface AppVC () <NEMeetingStatusListener>
    @end

    @implementation AppVC

    - (void)dealloc {
            [[NEMeetingKit getInstance].getMeetingService removeMeetingStatusListener:self];
        }

    - (void)onMeetingStatusChanged:(nonnull NEMeetingEvent *)event {
        
    }
    @end
    ```

## <span id="监听成员入会离会">监听成员入会离会</span>

通过注册会议成员监听接口，您可以实时获取会议中成员加入和离开的通知，以便实现自定义的业务逻辑处理。

### 功能说明

- **成员加入通知**：当有成员加入会议时，会触发 `onMemberJoinMeeting` 回调，返回新加入的成员列表。
- **成员离开通知**：当有成员离开会议时，会触发 `onMemberLeaveMeeting` 回调，返回离开的成员列表。
- **批量通知**：一次回调可能包含多个成员的加入或离开信息，SDK 会将同一时间段的成员变化合并通知。

::: note note
- **UI 全托管**：SDK 内部 UI 会自动更新会议成员列表，无需开发者手动处理 UI 更新。SDK 采用 UI 全托管的形式，会议界面中的成员列表、视频画面等 UI 元素都会由 SDK 自动维护和更新。
- **事件用途**：提供成员入会离会事件通知，主要是为了方便开发者实现自定义的业务逻辑，例如：
  - 记录成员进出日志
  - 统计会议参与情况
  - 发送自定义通知消息
  - 触发其他业务操作
- 该接口需要在加入会议后调用才能正常接收成员变化通知。
- 回调中的成员列表可能包含多个成员，建议遍历处理所有成员信息。
- 成员信息包含成员的用户 ID、昵称、角色等详细信息，可用于业务逻辑处理。
:::

### 使用步骤

1. 创建 `NEMeetingListener` 监听器实例，实现成员加入和离开的回调方法。

    **示例代码** 如下：

    ```Objective-C
    #import <NEMeetingKit/NEMeetingKit.h>

    // 使用类实现协议的方式
    @interface MyMeetingListener : NSObject <NEMeetingListener>
    @end

    @implementation MyMeetingListener

    - (void)onMemberJoinMeeting:(NSArray<NEMeetingMember *> *)userList {
        // 处理成员加入事件
        // userList 为新加入会议的成员列表
        // 注意：SDK 内部 UI 会自动更新，此处主要用于自定义业务逻辑处理
        for (NEMeetingMember *member in userList) {
            // 实现自定义业务逻辑，例如：记录日志、发送通知、统计数据等
            NSLog(@"成员加入会议: %@", member.nickname);
        }
    }

    - (void)onMemberLeaveMeeting:(NSArray<NEMeetingMember *> *)userList {
        // 处理成员离开事件
        // userList 为离开会议的成员列表
        // 注意：SDK 内部 UI 会自动更新，此处主要用于自定义业务逻辑处理
        for (NEMeetingMember *member in userList) {
            // 实现自定义业务逻辑，例如：记录日志、发送通知、统计数据等
            NSLog(@"成员离开会议: %@", member.nickname);
        }
    }

    @end

    // 创建监听器实例
    MyMeetingListener *meetingListener = [[MyMeetingListener alloc] init];
    ```

2. 注册监听器开始监听成员变化。

    **示例代码** 如下：

    ```Objective-C
    // 注册监听器
    [[[NEMeetingKit getInstance] getMeetingService] addMeetingListener:meetingListener];
    ```

3. 反注册监听器停止监听。

    **示例代码** 如下：

    ```Objective-C
    // 反注册监听器
    [[[NEMeetingKit getInstance] getMeetingService] removeMeetingListener:meetingListener];
    ```

## <span id="监听全局事件">监听全局事件</span>

通过注册全局事件回调接口，获取相应事件通知，目前支持监听 RTC 初始化和销毁相关的事件。

1. 注册回调接口 [`addGlobalEventListener`](https://doc.yunxin.163.com/docs/interface/meetingkit/iOS/doxygen/Latest/zh/interface_n_e_meeting_kit.html#a7c2910086360eb31f7139b51cec7cabd) 开始监听，并在回调方法中根据您的需求处理相应事件。

    ::: note note
    该接口在初始化 SDK 成功后即可调用。
    :::

    **示例代码** 如下：

    ```Objective-C
    @interface AppVC () <NEGlobalEventListener>
    @end

    @implementation AppVC

    - (void)viewDidLoad {
            [super viewDidLoad];
            [NEMeetingKit.getInstance addGlobalEventListener:self];
        }

    - (void)beforeRtcEngineInitializeWithRoomUuid:(NSString *)roomUuid
                                   rtcWrapper:(NERtcWrapper *)rtcWrapper {
    }

    - (void)afterRtcEngineInitializeWithRoomUuid:(NSString *)roomUuid
                                    rtcWrapper:(NERtcWrapper *)rtcWrapper {
    }

    - (void)beforeRtcEngineReleaseWithRoomUuid:(NSString *)roomUuid
                                    rtcWrapper:(NERtcWrapper *)rtcWrapper {
    }
    @end
    ```

2. 反注册回调接口 [`removeGlobalEventListener`](https://doc.yunxin.163.com/docs/interface/meetingkit/iOS/doxygen/Latest/zh/interface_n_e_meeting_kit.html#a541bcfd80f835df17df66a8ae9a745b3) 停止监听。

    **示例代码** 如下：

    ```Objective-C
    @interface AppVC () <NEGlobalEventListener>
    @end

    @implementation AppVC

    - (void)dealloc {
        [NEMeetingKit.getInstance removeGlobalEventListener:self];
    }

    - (void)beforeRtcEngineInitializeWithRoomUuid:(NSString *)roomUuid
                                   rtcWrapper:(NERtcWrapper *)rtcWrapper {
    }

    - (void)afterRtcEngineInitializeWithRoomUuid:(NSString *)roomUuid
                                    rtcWrapper:(NERtcWrapper *)rtcWrapper {
    }

    - (void)beforeRtcEngineReleaseWithRoomUuid:(NSString *)roomUuid
                                    rtcWrapper:(NERtcWrapper *)rtcWrapper {
    }
    @end
    ```