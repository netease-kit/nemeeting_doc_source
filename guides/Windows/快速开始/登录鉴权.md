本文介绍了网易会议组件（NEMeetingKit）提供的登录鉴权方式和示例。

## <span id="登录鉴权">调用时机</span>

您只有完成网易会议组件登录鉴权才可以使用网易会议组件的相关接口，包括创建会议、加入会议、编辑预约会议等。

## 前提条件

根据本文操作前，请确保您已经完成了以下操作：

- [初始化会议组件](https://doc.yunxin.163.com/meeting/guide/zM3MjE2MzM?platform=windows#初始化)。
- 调用服务端接口 [创建会议账号](https://doc.yunxin.163.com/meeting/server-apis/jU0MDAzNTg?platform=server)。

## 登录方式

网易会议组件提供了多种登录方式供您选择，具体通过 [`NEAccountService`](https://doc.yunxin.163.com/docs/interface/meetingkit/windows/doxygen/Latest/zh/class_n_e_account_service.html) 实现，如下表所示。

<style>
table th:first-of-type {
    width: 40%;
}
table th:nth-of-type(2) {
    width: 60%;
}
</style>

| 实现接口 | 登录方式说明 |
| --- | --- |
| [loginByEmail](https://doc.yunxin.163.com/docs/interface/meetingkit/windows/doxygen/Latest/zh/class_n_e_account_service.html#a121048b46b6a9b5826389079e5b88b6a) | 通过邮箱密码登录鉴权。 |
| [loginByPassword](https://doc.yunxin.163.com/docs/interface/meetingkit/windows/doxygen/Latest/zh/class_n_e_account_service.html#af4e67b55dbce0627d87bc10999ce650c) | 通过用户唯一 ID 和密码登录鉴权。 |
| [loginByPhoneNumber](https://doc.yunxin.163.com/docs/interface/meetingkit/windows/doxygen/Latest/zh/class_n_e_account_service.html#a26b05721bec005701cbe66c8761de348) | 通过电话号码密码登录鉴权。 |
| [loginByToken](https://doc.yunxin.163.com/docs/interface/meetingkit/windows/doxygen/Latest/zh/class_n_e_account_service.html#a8c52b16d525aa8983fc871413773b0dd) | 根据用户唯一 ID 和 Token 登录鉴权。 |
| [tryAutoLogin](https://doc.yunxin.163.com/docs/interface/meetingkit/windows/doxygen/Latest/zh/class_n_e_account_service.html#a1540d92456407c3dedf80f0ea02da966) | 尝试使用最近一次成功登录过的账号信息，进行自动登录。 |

:::note note
账号参数信息（`userUuid` 和 `token`）请从服务端接口 <a href="https://doc.yunxin.163.com/meeting/server-apis/jU0MDAzNTg?platform=server" target="_blank">meeting/api/v2/add-user</a> 获取，由您自行实现相关业务逻辑。
:::

## 登录示例

以下通过 **Token 登录**（`loginByToken`）方式为例，说明 NEMeetingKit 的登录鉴权逻辑，其他登录方式的鉴权逻辑同理。

1. 调用服务端接口 [创建账号](https://doc.yunxin.163.com/meeting/server-apis/jU0MDAzNTg?platform=server) 获取账号和 token。

2. 调用 [`loginByToken`](https://doc.yunxin.163.com/docs/interface/meetingkit/windows/doxygen/Latest/zh/class_n_e_account_service.html#a8c52b16d525aa8983fc871413773b0dd) 方法登录并进行回调处理，该接口无额外回调结果数据。

    **示例代码如下：**

    ```C++
    std::string account = "account";
    std::string token = "token";
    auto service = NEMeetingKit::getInstance()->getAccountService();
    if (service) {
        service->loginByToken(account, token, [this](MeetingErrorCode errorCode, const std::string& errorMessage, NEAccountInfo accountInfo) {
            PrintLog("MeetingSDK loginByToken code:" + std::to_string(errorCode) + ", errorMessage: " + errorMessage);
            PrintAccountInfo(accountInfo);
        });
    } else {
        PrintLog("MeetingKit is not initialized");
    }
    ```

## 获取用户信息

（可选）登录成功后，您可能需要获取用户的账号信息以进行进一步的操作，例如查询登录状态、更新 UI、同步数据或验证用户权限。

[`getAccountInfo`](https://doc.yunxin.163.com/docs/interface/meetingkit/windows/doxygen/Latest/zh/class_n_e_account_service.html#ae6da09f6ff6cd8696d7851f053ecfef1) 方法提供了一个异步的回调接口来获取这些信息。以下是如何在登录成功后调用 `getAccountInfo` 方法，并处理返回的账号信息。

您可以通过该接口查询登录状态，如果获取到非空的用户信息，说明已经成功登录，否则为未登录。

```C++
// 登录成功后获取账号信息
void getAccountInfoAfterLogin() {
    auto service = NEMeetingKit::getInstance()->getAccountService();
    if (service) {
        service->getAccountInfo([this](MeetingErrorCode errorCode, const std::string& errorMessage, const NEAccountInfo& accountInfo) {
            PrintLog("MeetingSDK getAccountInfo code:" + std::to_string(errorCode) + ", errorMessage: " + errorMessage);
            PrintAccountInfo(accountInfo);
        });
    } else {
        PrintLog("MeetingKit is not initialized");
    }
}
```

## 监听登录状态

您可以注册账号信息变更、用户登录信息变更等相关监听（[`NEAccountServiceListener`](https://doc.yunxin.163.com/docs/interface/meetingkit/windows/doxygen/Latest/zh/class_n_e_account_service_listener.html)），及时处理相关跳转以增强用户体验。

```C++
class MainWindow : public NEAccountServiceListener {
public:
    void onKickOut() override;
    void onAuthInfoExpired() override;
    void onReconnected() override;
    void onAccountInfoUpdated(NEAccountInfo accountInfo) override;
};

void MainWindow::onAddAccountServiceListenerBtnClicked() {
    PrintLog("onAddAccountServiceListenerBtnClicked");
    auto service = NEMeetingKit::getInstance()->getAccountService();
    if (service) {
        service->addListener(this);
    } else {
        PrintLog("MeetingKit is not initialized");
    }
}
void MainWindow::onRemoveAccountServiceListenerBtnClicked() {
    PrintLog("onRemoveAccountServiceListenerBtnClicked");
    auto service = NEMeetingKit::getInstance()->getAccountService();
    if (service) {
        service->removeListener(this);
    } else {
        PrintLog("MeetingKit is not initialized");
    }
}

void MainWindow::onKickOut() {
    PrintLog("onKickOut");
}
void MainWindow::onAuthInfoExpired() {
    PrintLog("onAuthInfoExpired");
}
void MainWindow::onReconnected() {
    PrintLog("onReconnected");
}
void MainWindow::onAccountInfoUpdated(NEAccountInfo accountInfo) {
    PrintLog("onAccountInfoUpdated");
    PrintAccountInfo(accountInfo);
}
```

## 注销登录

注销登录时，会注销当前用户已登录的账号，返回未登录状态。您可以调用 [`logout`](https://doc.yunxin.163.com/docs/interface/meetingkit/windows/doxygen/Latest/zh/class_n_e_account_service.html#ae97810255d4c3470661474cb61fddccb) 方法注销当前账号并进行回调处理。该接口无额外回调结果数据，您可根据错误码判断接口是否调用成功。

::: note note
账号注销后，登录状态会被清空，且无法再使用该账号创建会议。
:::

**示例代码如下：**

```C++
void MainWindow::onLogoutBtnClicked() {
    PrintLog("onLogoutBtnClicked");
    auto service = NEMeetingKit::getInstance()->getAccountService();
    if (service) {
        service->logout([this](MeetingErrorCode errorCode, const std::string& errorMessage) {
            PrintLog("MeetingSDK logout code:" + std::to_string(errorCode) + ", errorMessage: " + errorMessage);
        });
    } else {
        PrintLog("MeetingKit is not initialized");
    }
}
```